<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS 给App添加TouchID验证 · 宫城</title><meta name="description" content="iOS 给App添加TouchID验证 - 宫城"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/CaptainAmerica.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/CaptainAmerica.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/yuzeyang" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS 给App添加TouchID验证</h1><div class="post-info">2016年1月19日</div><div class="post-content"><p>TouchID验证这个在iOS8中已经对开发者开放使用了，而且需在5s以上真机才能使用，这个出来已经比较早了，相信很多人都应该已经知道怎么使用TouchID了，但是就目前我使用的App来说，看到使用TouchID验证的占得数量并不多，对于一些涉及到安全性的App来说，很有可能你的解锁验证、App登录以及支付验证都是用的TouchID使用TouchID验证还是有风险的，但是有些App增加使用TouchID作为一种验证还是不错的选择，既快捷又方便，对于开发者来说增加的成本也很低</p>
<a id="more"></a>
<p>这个是我所讲的demo的源码<a href="https://github.com/Yuzeyang/TouchIDDemo" target="_blank" rel="external">TouchID demo</a>，代码量非常少</p>
<hr>
<p>下面我就来介绍下怎么给App增加TouchID验证吧</p>
<p>首先，要使用TouchID，得先引入LocalAuthentication.framework这个库，这里面只有四个头文件，但实际使用到的只有LAContext.h和LAError.h这两个头文件</p>
<p>在做验证时，我们只需要使用到LAContext中的两个方法</p>
<p>我们先初始化一个LAContext对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LAContext *ctx = [[LAContext alloc] init];</div></pre></td></tr></table></figure>
<p>然后调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (BOOL)canEvaluatePolicy:(LAPolicy)policy error:(NSError*__autoreleasing*)error;</div></pre></td></tr></table></figure>
<p>方法来确定当前指定的验证方法能否使用，LAPolicy是个枚举，里面只有两个值，一个是LAPolicyDeviceOwnerAuthenticationWithBiometrics（使用该设备的TouchID验证），LAPolicyDeviceOwnerAuthentication（使用该设备的TouchID和设备密码验证）</p>
<p>这里返回的是一个布尔值，错误处理我等下一起说明，当返回可以使用当前指定的验证法方法时，我们调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)evaluatePolicy:(LAPolicy)policy localizedReason:(NSString*)localizedReason reply:(void(^)(BOOLsuccess,NSError*__nullableerror))reply;</div></pre></td></tr></table></figure>
<p>方法开始使用TouchID验证，localizedReason指的是在弹出TouchID验证框时提示的文字，reply指的是在做指纹验证或者密码验证后的结果返回，我将localizedReason用@”通过Home键验证已有手机指纹”作为提示，下图比较直观</p>
<p><img src="http://7xtit4.com1.z0.glb.clouddn.com/TouchID1.png!600x600" alt=""></p>
<p>刚才布尔值的错误对应的是哪些呢？</p>
<p>这就用到了LAError.h这个类，这个类定义了目前所有的验证失败的错误code，我直接将它copy过来了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">typedefNS_ENUM(NSInteger, LAError)</div><div class="line">&#123;</div><div class="line">	/// 校验失败</div><div class="line">	LAErrorAuthenticationFailed =kLAErrorAuthenticationFailed,</div><div class="line"></div><div class="line">    /// 用户取消验证</div><div class="line">	LAErrorUserCancel=kLAErrorUserCancel,</div><div class="line"></div><div class="line">	/// 用户回退（返回密码校验）</div><div class="line">	LAErrorUserFallback=kLAErrorUserFallback,</div><div class="line"></div><div class="line">	/// 系统取消校验</div><div class="line">	LAErrorSystemCancel=kLAErrorSystemCancel,</div><div class="line"></div><div class="line">	/// 密码未设置</div><div class="line">	LAErrorPasscodeNotSet=kLAErrorPasscodeNotSet,</div><div class="line"></div><div class="line">	/// 指纹不正确</div><div class="line">	LAErrorTouchIDNotAvailable=kLAErrorTouchIDNotAvailable,</div><div class="line"></div><div class="line">	/// 没有录入指纹</div><div class="line">	LAErrorTouchIDNotEnrolled=kLAErrorTouchIDNotEnrolled,</div><div class="line"></div><div class="line">	/// TouchID被锁定</div><div class="line">	LAErrorTouchIDLockoutNS_ENUM_AVAILABLE(10_11,9_0) =kLAErrorTouchIDLockout,</div><div class="line"></div><div class="line">	/// App取消验证</div><div class="line">	LAErrorAppCancelNS_ENUM_AVAILABLE(10_11,9_0) =kLAErrorAppCancel,</div><div class="line"></div><div class="line">	/// 无效的上下文环境</div><div class="line">	LAErrorInvalidContextNS_ENUM_AVAILABLE(10_11,9_0) =kLAErrorInvalidContext</div><div class="line">&#125;NS_ENUM_AVAILABLE(10_10,8_0);</div></pre></td></tr></table></figure>
<p>而前四种error是针对于能确定使用验证后，在验证后返回的错误</p>
<p>后六种error是针对于不能使用验证的原因</p>
<p>你可以针对这些原因做一些相应的操作，比如弹窗等等</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/01/17/GCDAsyncSocket-socket/" class="prev">上一篇</a><a href="/2016/01/26/red-packet/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zeeyang';
var disqus_identifier = '2016/01/19/TouchID/';
var disqus_title = 'iOS 给App添加TouchID验证';
var disqus_url = 'http://yuzeyang.github.io/2016/01/19/TouchID/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zeeyang.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://yuzeyang.github.io">宫城</a>, Talk is cheap, show me the code.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></body></html>