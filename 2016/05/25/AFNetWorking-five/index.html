<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS AFNetWorking源码详解（五） · 宫城</title><meta name="description" content="iOS AFNetWorking源码详解（五） - 宫城"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/CaptainAmerica.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/CaptainAmerica.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/yuzeyang" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS AFNetWorking源码详解（五）</h1><div class="post-info">2016年5月25日</div><div class="post-content"><p>AFURLRequestSerialization是用来对发出的请求进行一些处理</p>
<a id="more"></a>
<p>AFPercentEscapedStringFromString方法将string里面的:#[]@!$&amp;’()*+,;=字符替换成%</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString * AFPercentEscapedStringFromString(NSString *string) &#123;&#10;  &#9;static NSString * const kAFCharactersGeneralDelimitersToEncode = @&#34;:#[]@&#34;; // does not include &#34;?&#34; or &#34;/&#34; due to RFC 3986 - Section 3.4&#10;    static NSString * const kAFCharactersSubDelimitersToEncode = @&#34;!$&#38;&#39;()*+,;=&#34;;&#10;&#9;&#10;  &#9;// &#20174;&#21487;&#29992;&#23383;&#31526;&#26367;&#25442;&#21024;&#38500;&#25481;:#[]@!$&#38;&#39;()*+,;=&#36825;&#20123;&#23383;&#31526;&#10;    NSMutableCharacterSet * allowedCharacterSet = [[NSCharacterSet URLQueryAllowedCharacterSet] mutableCopy];&#10;    [allowedCharacterSet removeCharactersInString:[kAFCharactersGeneralDelimitersToEncode stringByAppendingString:kAFCharactersSubDelimitersToEncode]];&#10;&#10;&#9;// FIXME: https://github.com/AFNetworking/AFNetworking/pull/3028&#10;    // return [string stringByAddingPercentEncodingWithAllowedCharacters:allowedCharacterSet];&#10;&#9;&#10;  &#9;// &#22768;&#26126;&#25209;&#37327;&#22788;&#29702;&#30340;&#22823;&#23567;&#20026;50&#10;    static NSUInteger const batchSize = 50;&#10;&#10;    NSUInteger index = 0;&#10;    NSMutableString *escaped = @&#34;&#34;.mutableCopy;&#10;&#9;&#10;  &#9;// &#24490;&#29615;&#23558;string&#37324;&#38754;:#[]@!$&#38;&#39;()*+,;=&#30340;&#23383;&#31526;&#26367;&#25442;&#25104;%&#10;    while (index &#60; string.length) &#123;&#10;#pragma GCC diagnostic push&#10;#pragma GCC diagnostic ignored &#34;-Wgnu&#34;&#10;        NSUInteger length = MIN(string.length - index, batchSize);&#10;#pragma GCC diagnostic pop&#10;        NSRange range = NSMakeRange(index, length);&#10;&#10;        // To avoid breaking up character sequences such as &#128116;&#127995;&#128110;&#127997;&#10;        range = [string rangeOfComposedCharacterSequencesForRange:range];&#10;&#10;        NSString *substring = [string substringWithRange:range];&#10;        NSString *encoded = [substring stringByAddingPercentEncodingWithAllowedCharacters:allowedCharacterSet];&#10;        [escaped appendString:encoded];&#10;&#10;        index += range.length;&#10;    &#125;&#10;&#10;&#9;return escaped;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>在AFQueryStringPair类里面有个- URLEncodedStringValue方法，将请求里面的URL参数转成field=value形式</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSString *)URLEncodedStringValue &#123;&#10;    if (!self.value || [self.value isEqual:[NSNull null]]) &#123;&#10;        return AFPercentEscapedStringFromString([self.field description]);&#10;    &#125; else &#123;&#10;        return [NSString stringWithFormat:@&#34;%@=%@&#34;, AFPercentEscapedStringFromString([self.field description]), AFPercentEscapedStringFromString([self.value description])];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>字典里面是我们查询的key和value，我们通过将字典内容转成AFQueryStringPair对象，调用- URLEncodedStringValue方法，转成key=value，放到mutablePairs数组里，最后用&amp;符拼接起来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString * AFQueryStringFromParameters(NSDictionary *parameters) &#123;&#10;    NSMutableArray *mutablePairs = [NSMutableArray array];&#10;    for (AFQueryStringPair *pair in AFQueryStringPairsFromDictionary(parameters)) &#123;&#10;        [mutablePairs addObject:[pair URLEncodedStringValue]];&#10;    &#125;&#10;&#10;    return [mutablePairs componentsJoinedByString:@&#34;&#38;&#34;];&#10;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSArray * AFQueryStringPairsFromKeyAndValue(NSString *key, id value) &#123;&#10;    NSMutableArray *mutableQueryStringComponents = [NSMutableArray array];&#10;&#10;    NSSortDescriptor *sortDescriptor = [NSSortDescriptor sortDescriptorWithKey:@&#34;description&#34; ascending:YES selector:@selector(compare:)];&#10;&#9;&#10;  &#9;// &#22914;&#26524;&#26159;&#23383;&#20856;&#65292;&#36941;&#21382;&#21518;&#36820;&#22238;key[nestedKey]=nestedValue&#10;    if ([value isKindOfClass:[NSDictionary class]]) &#123;&#10;        NSDictionary *dictionary = value;&#10;        // Sort dictionary keys to ensure consistent ordering in query string, which is important when deserializing potentially ambiguous sequences, such as an array of dictionaries&#10;        for (id nestedKey in [dictionary.allKeys sortedArrayUsingDescriptors:@[ sortDescriptor ]]) &#123;&#10;            id nestedValue = dictionary[nestedKey];&#10;            if (nestedValue) &#123;&#10;                [mutableQueryStringComponents addObjectsFromArray:AFQueryStringPairsFromKeyAndValue((key ? [NSString stringWithFormat:@&#34;%@[%@]&#34;, key, nestedKey] : nestedKey), nestedValue)];&#10;            &#125;&#10;        &#125;&#10;    &#125; // &#22914;&#26524;&#26159;&#25968;&#32452;&#65292;&#36941;&#21382;&#21518;&#36820;&#22238;key[]=nestedValue&#10;  &#9;else if ([value isKindOfClass:[NSArray class]]) &#123;&#10;        NSArray *array = value;&#10;        for (id nestedValue in array) &#123;&#10;            [mutableQueryStringComponents addObjectsFromArray:AFQueryStringPairsFromKeyAndValue([NSString stringWithFormat:@&#34;%@[]&#34;, key], nestedValue)];&#10;        &#125;&#10;    &#125; // &#22914;&#26524;&#26159;&#38598;&#21512;&#65292;&#36941;&#21382;&#21518;&#36820;&#22238;key=obj&#10;  &#9;else if ([value isKindOfClass:[NSSet class]]) &#123;&#10;        NSSet *set = value;&#10;        for (id obj in [set sortedArrayUsingDescriptors:@[ sortDescriptor ]]) &#123;&#10;            [mutableQueryStringComponents addObjectsFromArray:AFQueryStringPairsFromKeyAndValue(key, obj)];&#10;        &#125;&#10;    &#125; // &#20854;&#20182;&#36820;&#22238;key=value &#10;  &#9;else &#123;&#10;        [mutableQueryStringComponents addObject:[[AFQueryStringPair alloc] initWithField:key value:value]];&#10;    &#125;&#10;&#10;    return mutableQueryStringComponents;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>假设传入的是，我将key,value放到数组里面，再放到mutableQueryStringComponents里</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSet *afSet = [NSSet setWithObjects:@(1),@(2), nil];&#10;NSDictionary *afDic = @&#123;@&#34;dickey&#34;: @&#123;@&#34;nestKey&#34;: @&#34;nestValue&#34;&#125;,&#10;                        @&#34;arrayKey&#34;: @[@[@(1)]],&#10;                        @&#34;setKey&#34;: afSet,&#10;                        @&#34;generalKey&#34;: @&#34;generalValue&#34;&#125;;&#10;NSArray *resultArray = AFQueryStringPairsFromKeyAndValue(nil, afDic);</span><br></pre></td></tr></table></figure>
<p>打印得到的结果是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[arrayKey, 1],&#10; [dickey[nestKey], nestValue],&#10; [generalKey, generalValue],&#10; [setKey, 1]&#65292;&#10; [setKey,2]]</span><br></pre></td></tr></table></figure>
<p>我们使用AFHTTPRequestSerializer对HTTP请求的头部进行处理</p>
<p>首先调用+ serializer进行初始化，里面调用了自己init方法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)serializer &#123;&#10;    return [[self alloc] init];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>init里面先将Accept-Language存到mutableHTTPRequestHeaders里</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#23558;mainBundle&#37324;&#38754;&#26681;&#25454;&#20351;&#29992;&#35821;&#35328;&#30340;&#20248;&#20808;&#39034;&#24207;&#25918;&#21040;acceptLanguagesComponents&#37324;&#38754;&#65292;&#20877;&#29992;&#34;,&#34;&#20998;&#38548;&#65292;&#23384;&#21040;mutableHTTPRequestHeaders&#23383;&#20856;&#37324;&#38754;&#10;  &#9;NSMutableArray *acceptLanguagesComponents = [NSMutableArray array];&#10;    [[NSLocale preferredLanguages] enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) &#123;&#10;        float q = 1.0f - (idx * 0.1f);&#10;        [acceptLanguagesComponents addObject:[NSString stringWithFormat:@&#34;%@;q=%0.1g&#34;, obj, q]];&#10;        *stop = q &#60;= 0.5f;&#10;    &#125;];&#10;    [self setValue:[acceptLanguagesComponents componentsJoinedByString:@&#34;, &#34;] forHTTPHeaderField:@&#34;Accept-Language&#34;];</span><br></pre></td></tr></table></figure>
<p>然后拼接User-Agent，格式为”%@/%@ (%@; iOS %@; Scale/%0.2f)”，里面需要5个参数，第一个参数先获取项目名，如果没有，就用BundleIdentifier，第二个参数先获取短版本号，如果没有就用版本号，第三个参数是当前设备的类型，第四个参数是当前设备的版本号，第五个参数是屏幕的比例</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString *userAgent = nil;&#10;#pragma clang diagnostic push&#10;#pragma clang diagnostic ignored &#34;-Wgnu&#34;&#10;#if TARGET_OS_IOS&#10;    userAgent = [NSString stringWithFormat:@&#34;%@/%@ (%@; iOS %@; Scale/%0.2f)&#34;, [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleExecutableKey] ?: [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleIdentifierKey], [[NSBundle mainBundle] infoDictionary][@&#34;CFBundleShortVersionString&#34;] ?: [[NSBundle mainBundle] infoDictionary][(__bridge NSString *)kCFBundleVersionKey], [[UIDevice currentDevice] model], [[UIDevice currentDevice] systemVersion], [[UIScreen mainScreen] scale]];&#10;#elif TARGET_OS_WATCH&#10;    // ... &#10;#elif defined(__MAC_OS_X_VERSION_MIN_REQUIRED)&#10;    // ...&#10;#endif&#10;#pragma clang diagnostic pop&#10;if (userAgent) &#123;&#10;        if (![userAgent canBeConvertedToEncoding:NSASCIIStringEncoding]) &#123;&#10;            NSMutableString *mutableUserAgent = [userAgent mutableCopy];&#10;            if (CFStringTransform((__bridge CFMutableStringRef)(mutableUserAgent), NULL, (__bridge CFStringRef)@&#34;Any-Latin; Latin-ASCII; [:^ASCII:] Remove&#34;, false)) &#123;&#10;                userAgent = mutableUserAgent;&#10;            &#125;&#10;        &#125;&#10;        [self setValue:userAgent forHTTPHeaderField:@&#34;User-Agent&#34;];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>然后设置属性的监听，这些属性在头文件里面都可以找到，实现文件里面也实现了set方法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.mutableObservedChangedKeyPaths = [NSMutableSet set];&#10;    for (NSString *keyPath in AFHTTPRequestSerializerObservedKeyPaths()) &#123;&#10;        if ([self respondsToSelector:NSSelectorFromString(keyPath)]) &#123;&#10;            [self addObserver:self forKeyPath:keyPath options:NSKeyValueObservingOptionNew context:AFHTTPRequestSerializerObserverContext];&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static NSArray * AFHTTPRequestSerializerObservedKeyPaths() &#123;&#10;    static NSArray *_AFHTTPRequestSerializerObservedKeyPaths = nil;&#10;    static dispatch_once_t onceToken;&#10;    dispatch_once(&#38;onceToken, ^&#123;&#10;        _AFHTTPRequestSerializerObservedKeyPaths = @[NSStringFromSelector(@selector(allowsCellularAccess)), NSStringFromSelector(@selector(cachePolicy)), NSStringFromSelector(@selector(HTTPShouldHandleCookies)), NSStringFromSelector(@selector(HTTPShouldUsePipelining)), NSStringFromSelector(@selector(networkServiceType)), NSStringFromSelector(@selector(timeoutInterval))];&#10;    &#125;);&#10;&#10;    return _AFHTTPRequestSerializerObservedKeyPaths;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>通过KVO判断是否是新值，如果是的话，就加到mutableObservedChangedKeyPaths里面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath&#10;                      ofObject:(__unused id)object&#10;                        change:(NSDictionary *)change&#10;                       context:(void *)context&#10;&#123;&#10;    if (context == AFHTTPRequestSerializerObserverContext) &#123;&#10;        if ([change[NSKeyValueChangeNewKey] isEqual:[NSNull null]]) &#123;&#10;            [self.mutableObservedChangedKeyPaths removeObject:keyPath];&#10;        &#125; else &#123;&#10;            [self.mutableObservedChangedKeyPaths addObject:keyPath];&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>设置验证字段</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setAuthorizationHeaderFieldWithUsername:(NSString *)username&#10;                                       password:(NSString *)password&#10;&#123;&#10;    NSData *basicAuthCredentials = [[NSString stringWithFormat:@&#34;%@:%@&#34;, username, password] dataUsingEncoding:NSUTF8StringEncoding];&#10;    NSString *base64AuthCredentials = [basicAuthCredentials base64EncodedStringWithOptions:(NSDataBase64EncodingOptions)0];&#10;    [self setValue:[NSString stringWithFormat:@&#34;Basic %@&#34;, base64AuthCredentials] forHTTPHeaderField:@&#34;Authorization&#34;];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>初始化之后，需要调用</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableURLRequest *)requestWithMethod:(NSString *)method&#10;                                 URLString:(NSString *)URLString&#10;                                parameters:(id)parameters&#10;                                     error:(NSError *__autoreleasing *)error&#10;&#123;&#10;    // &#26029;&#35328;                                     &#10;    NSParameterAssert(method);&#10;    NSParameterAssert(URLString);&#10;&#9;&#10;    NSURL *url = [NSURL URLWithString:URLString];&#10;&#10;    NSParameterAssert(url);&#10;&#9;// &#26681;&#25454;url&#21021;&#22987;&#21270;request&#10;    NSMutableURLRequest *mutableRequest = [[NSMutableURLRequest alloc] initWithURL:url];&#10;    // &#35774;&#32622;HTTP&#26041;&#27861;                                   &#10;    mutableRequest.HTTPMethod = method;&#10;&#9;// &#26681;&#25454;mutableObservedChangedKeyPaths&#23384;&#20648;&#30340;&#23646;&#24615;&#65292;&#35774;&#32622;&#21040;mutableRequest&#10;    for (NSString *keyPath in AFHTTPRequestSerializerObservedKeyPaths()) &#123;&#10;        if ([self.mutableObservedChangedKeyPaths containsObject:keyPath]) &#123;&#10;            [mutableRequest setValue:[self valueForKeyPath:keyPath] forKey:keyPath];&#10;        &#125;&#10;    &#125;&#10;&#9;// &#35843;&#29992;- [requestBySerializingRequest:withParameters:error]&#26041;&#27861;&#10;    mutableRequest = [[self requestBySerializingRequest:mutableRequest withParameters:parameters error:error] mutableCopy];&#10;&#10;&#9;return mutableRequest;&#10;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSURLRequest *)requestBySerializingRequest:(NSURLRequest *)request&#10;                               withParameters:(id)parameters&#10;                                        error:(NSError *__autoreleasing *)error&#10;&#123;&#10;    // &#26029;&#35328;                                      &#10;    NSParameterAssert(request);&#10;&#10;    NSMutableURLRequest *mutableRequest = [request mutableCopy];&#10;    // &#26681;&#25454;HTTPRequestHeaders&#26469;&#35774;&#32622;mutableRequest&#30340;&#22836;&#37096;&#23383;&#27573;&#10;    [self.HTTPRequestHeaders enumerateKeysAndObjectsUsingBlock:^(id field, id value, BOOL * __unused stop) &#123;&#10;        if (![request valueForHTTPHeaderField:field]) &#123;&#10;            [mutableRequest setValue:value forHTTPHeaderField:field];&#10;        &#125;&#10;    &#125;];&#10;&#9;&#10;    NSString *query = nil;&#10;    if (parameters) &#123;&#10;        if (self.queryStringSerialization) &#123;&#10;          &#9;// &#22914;&#26524;&#35774;&#32622;&#20102;queryStringSerialization&#36825;&#20010;block&#30340;&#35805;&#65292;&#23601;&#38656;&#35201;&#35774;&#32622;&#19968;&#20010;&#33258;&#23450;&#20041;&#30340;&#26597;&#35810;&#35821;&#21477;&#24207;&#21015;&#21270;&#26041;&#27861;&#65292;&#36716;&#25104;query&#26597;&#35810;&#21442;&#25968;&#10;            NSError *serializationError;&#10;            query = self.queryStringSerialization(request, parameters, &#38;serializationError);&#10;&#10;            if (serializationError) &#123;&#10;                if (error) &#123;&#10;                    *error = serializationError;&#10;                &#125;&#10;&#10;                return nil;&#10;            &#125;&#10;        &#125; else &#123;&#10;          &#9;// &#22914;&#26524;&#27809;&#26377;&#35774;&#32622;&#65292;&#21017;&#35843;&#29992;AFQueryStringFromParameters&#26041;&#27861;&#65292;&#36716;&#25104;query&#26597;&#35810;&#21442;&#25968;&#10;            switch (self.queryStringSerializationStyle) &#123;&#10;                case AFHTTPRequestQueryStringDefaultStyle:&#10;                    query = AFQueryStringFromParameters(parameters);&#10;                    break;&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;&#9;&#10;    // &#23558;&#25340;&#25509;&#22909;&#30340;query&#35821;&#21477;&#25918;&#21040; mutableRequest.URL&#25110;&#32773;&#25918;&#21040;                                    mutableRequest&#30340;HTTPBody&#37324;&#10;    if ([self.HTTPMethodsEncodingParametersInURI containsObject:[[request HTTPMethod] uppercaseString]]) &#123;&#10;        if (query) &#123;&#10;            mutableRequest.URL = [NSURL URLWithString:[[mutableRequest.URL absoluteString] stringByAppendingFormat:mutableRequest.URL.query ? @&#34;&#38;%@&#34; : @&#34;?%@&#34;, query]];&#10;        &#125;&#10;    &#125; else &#123;&#10;        // #2864: an empty string is a valid x-www-form-urlencoded payload&#10;        if (!query) &#123;&#10;            query = @&#34;&#34;;&#10;        &#125;&#10;        if (![mutableRequest valueForHTTPHeaderField:@&#34;Content-Type&#34;]) &#123;&#10;            [mutableRequest setValue:@&#34;application/x-www-form-urlencoded&#34; forHTTPHeaderField:@&#34;Content-Type&#34;];&#10;        &#125;&#10;        [mutableRequest setHTTPBody:[query dataUsingEncoding:self.stringEncoding]];&#10;    &#125;&#10;&#10;    return mutableRequest;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>下面的话，基本都是对多部分数据进行组装</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/05/27/AFNetWorking-six/" class="prev">上一篇</a><a href="/2016/05/23/AFNetWorking-four/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zeeyang';
var disqus_identifier = '2016/05/25/AFNetWorking-five/';
var disqus_title = 'iOS AFNetWorking源码详解（五）';
var disqus_url = 'http://yuzeyang.github.io/2016/05/25/AFNetWorking-five/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zeeyang.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://yuzeyang.github.io">宫城</a>, Talk is cheap, show me the code.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></body></html>